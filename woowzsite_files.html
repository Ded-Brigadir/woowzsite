<!DOCTYPE HTML>
<meta charset="utf-8">
<title>Woowzsites Files</title>
<link rel="icon" type="image/x-icon" href="source/folder.ico">

<style>
@font-face {
	font-family: "comfortaa";
	src: url("source/Comfortaa.ttf") format('opentype');
}
	
html{
	background-color:rgb(50,50,50);
	cursor:default;
	font-family: comfortaa;
}

.white-font{
	color:white;
	text-shadow: 5px 5px 0px rgba(0, 0, 0, 0.5);
	cursor:default;
}

::selection{
    background-color: transparent;
}

.src::selection{
	background-color: rgb(100,100,255);
	color: white;
}

.custom-cursor{
	cursor:auto;
}

.background-image-div{}

.image{
	image-rendering: pixelated;
}

.div-image{
	background-image:url('source/transparent.png');
}

button{
	cursor:pointer;
	font-family: comfortaa;
}

select{
	cursor:pointer;
	font-family: comfortaa;
}
</style>

<body>
	<div class="background-image-div custom-cursor" style="margin:0px;">
		<div style="background-color:rgba(0,0,0,0.2);">
			<font class="white-font" style="font-size:5em; padding-left:10px;"><img style="image-rendering: pixelated; height:0.7em;" src="source/newfolder.png"> Woowzsites Files</font><br>
			<font class="white-font">Задний фон: </font><select id="background-select" onchange="ChangeStyle('div-image',`background-image:url('`+document.getElementById('background-select').value+`')`);">
				<option value="source/transparent.png">Светлый</option>
				<option value="source/transparent-dark.png">Тёмный</option>
				<option value="source/transparent-red.png">Красный</option>
				<option value="source/transparent-green.png">Зелёный</option>
				<option value="source/transparent-blue.png">Синий</option>
				<option value="source/transparent-yellow.png">Жёлтый</option>
				<option value="source/white.png">Чистый белый</option>
				<option value="source/black.png">Чистый чёрный</option>
				<option value="source/invisible.png">Прозрачный</option>
			</select> 
			<button onclick="ChangeStyle('background-image-div',`background-image:url('source/invisible.png');`)">Сбросить главный задний фон</button> 
			<button onclick="ChangeStyle('custom-cursor',`cursor:auto;`)">Сбросить курсор</button>
			<input type="checkbox" id="checkbox" name="checkbox" style="Transform: scale(1.6) translateY(1px);" onchange="var value=document.getElementById('checkbox').checked;ChangeStyle('image',value?'image-rendering: auto;':'image-rendering: pixelated;');"> <font class="white-font">Сделать изображения размытыми</font>
			<hr></div>
		<font class="white-font" style="font-size:5em;">(<font id="total-loading">?</font>/<font id="total-all">?</font>) <font id="total-proc">?</font>% <font id="finish-ms" style="font-size: 0.75em;"></font></font>
		<div id="explorer"></div>
	</div>
</body>

<script src="source/source.js"></script>
<script>
	var disable = false;

	var explorer = document.getElementById("explorer")
	var starttime = {};
	var types = {
		"idk": "<font style='color:red;'>UNKNOWN</font>",
		"png": "PNG",
		"jpg": "JPEG",
		"gif": "GIF",
		"ico": "ICON",
		"cur": "CURSOR",
		"mp4": "VIDEO",
	}
	
	async function CopyToClipboard(text) {
		console.log("Copy ["+text+"]");
		try {
			await navigator.clipboard.writeText(text);
		} catch (error) {
			console.error(error.message);
		}
	}
	
	function ChangeIcon(newicon){
		var link = document.querySelector("link[rel*='icon']") || document.createElement('link');
		link.type = 'image/x-icon';
		link.rel = 'shortcut icon';
		link.href = newicon;
		document.head.appendChild(link);
	}
	
	function ChangeStyle(clas,styl){
		var styleElement = document.createElement('style');
		styleElement.innerHTML = `
			.${clas} {
				${styl}
			}
		`;

		document.head.appendChild(styleElement);
	}
	
	var counts = {}
	var fullcounts = [0,0]
	function GenerateTable(text,tabl){
		if(disable){return;}
		
		counts[text] = [tabl.length,0];
		fullcounts = [fullcounts[0]+tabl.length,fullcounts[1]];
		document.getElementById("total-all").innerHTML = fullcounts[0];
		var result = `<font class="white-font" style="font-size:5em;">${text} <font style="font-size:0.5em;">(<font id="${text}-loaded">?</font>/`+tabl.length+`) <font id="${text}-proc">?</font>%</font> <font id="${text}-img"><img style="height:0.5em;" src="source/loading.gif"></font></font><br><div id="${text}" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 10px;">`
		
		function LoadSource(that,src,text,type){
			console.log(fullcounts[0],fullcounts[1])
			if(fullcounts[0]==fullcounts[1]+1){
				document.getElementById("finish-ms").innerHTML = (new Date() - compiletimestart)/1000 + "sec";
			}
		
			var type = "idk"
			if(src.includes(".png")){type="png"}
			if(src.includes(".jpg")){type="jpg"}
			if(src.includes(".gif")){type="gif"}
			if(src.includes(".ico")){type="ico"}
			if(src.includes(".cur")){type="cur"}
			if(src.includes(".mp4")){type="mp4"}
		
			var x = that.width;
			var y = that.height;
			var time = new Date().getTime() - starttime[src];
			var time_col = "black";
			if(time>1000){time_col="green";}
			if(time>200){time_col="orange";}
			if(time>3000){time_col="red";}
			if(time>4000){time_col="magenta";}
			if(time>5000){time_col="white; background-color:black";}
			if(time>50000){time_col="yellow; background-color:black";}
			if(time>100000){time_col="orange; background-color:black";}
			if(time>200000){time_col="red; background-color:black";}
			document.getElementById(text).innerHTML = document.getElementById(text).innerHTML + (`<div class="grid-element" id="${src}"><div class="div-image" `+(type!="mp4"?`onclick="var link=document.createElement('a');link.href='${src}';link.target='_blank';link.click();"`:"")+` style="background-size: auto; background-repeat: repeat; `+(type=="mp4"?"":`cursor:`+(type=="cur"?"url('"+src+"'),auto":"pointer")+`;`)+` min-height:300px; height:350px; `+(type!="mp4"?"padding: 10px;":"background-image:url('source/black.png');")+` display:flex; justify-content: center; align-items: center;">
			`+(type=="mp4"?
			`<video style="width:100%; height:100%; object-fit: fill;" controls><source src="${src}#t=0.1" type="video/mp4"></video>`
			:
			`<img class="image" style="min-width:100px; max-width:100%; max-height:100%;" src="${src}">`
			)+`
			</div><div style="background-color:rgb(250,250,250); height:110px; white-space: nowrap;"><div style="padding:10px; height:calc(100% - 20px); overflow-y:hidden; overflow-x: auto;"><font class="src" style="cursor:pointer;" onclick="CopyToClipboard('${src}');">${src}</font> (`+types[type]+`)<br>
			<font style="color:${time_col};">${time}</font>ms<br>`+
			((type=="png"||type=="jpg"||type=="gif")?`<button onclick="ChangeStyle('div-image',\`background-image:url('${src}');\`);">Установить передний фон</button><br><button onclick="ChangeStyle('background-image-div',\`background-image:url('${src}');\`);">Установить задний фон</button>`:``)+
			((type=="ico")?`<button onclick="ChangeIcon('${src}'); document.title='${src}';">Установить иконку</button>`:``)+
			((type=="cur")?`<button onclick="ChangeStyle('custom-cursor',\`cursor:url('${src}'),auto;\`);">Установить курсор</button>`:``)
			+`</div></div></div>`)
			var c = counts[text][1]+1;
			counts[text] = [counts[text][0],c]
			document.getElementById(text+"-loaded").innerHTML = c
			document.getElementById(text+"-proc").innerHTML = Math.floor((c/counts[text][0])*10000)/100
			if(c >= counts[text][0]){document.getElementById(text+"-img").innerHTML=""}
				
			fullcounts = [fullcounts[0],fullcounts[1]+1];
			document.getElementById("total-loading").innerHTML = fullcounts[1];
			document.getElementById("total-proc").innerHTML = Math.floor((fullcounts[1]/fullcounts[0])*10000)/100;
				
			var parentElement = document.getElementById(text);
			var childElements = Array.from(parentElement.querySelectorAll('.grid-element'));

			childElements.sort(function(a, b){
				return a.id.localeCompare(b.id);
			});

			childElements.forEach(function(child){
				parentElement.appendChild(child);
			});
		}
		function OnError(src,text){
			document.getElementById(text).innerHTML = document.getElementById(text).innerHTML + (`<div class="grid-element" id="!!!!!!ERROR"><div class="div-image" style="background-size: auto; background-repeat: repeat; min-height:300px; height:350px; display:flex; justify-content: center; align-items: center;">
			<img class="image" style="width:100%; height:100%;" src="source/onerror.png">
			</div><div style="background-color:rgb(250,250,250); height:110px; white-space: nowrap;"><div style="padding:10px; height:calc(100% - 20px); overflow-y:hidden; overflow-x: auto;"><font style="cursor:pointer;" onclick="CopyToClipboard('${src}');">${src}</font> (<font style='color:red;'>ERROR</font>)</div></div></div>`)
		}
		
		for(let src of tabl){
			starttime[src] = new Date().getTime();
			
			var type = "idk"
			if(src.includes(".png")){type="png"}
			if(src.includes(".jpg")){type="jpg"}
			if(src.includes(".gif")){type="gif"}
			if(src.includes(".ico")){type="ico"}
			if(src.includes(".cur")){type="cur"}
			if(src.includes(".mp4")){type="mp4"}

			if(type=="mp4"){
				var video = document.createElement('video');
				video.onloadedmetadata = function() { LoadSource(video,src,text); };
				video.onerror = function() { OnError(src,text); };
				video.src = src;
			}else{
				var img = new Image();
				img.onload = function(){ LoadSource(img,src,text); }
				img.onerror = function(){ OnError(src,text); }
				img.src = src;
			}
		}
		
		result = result + `</div><br>`
		explorer.innerHTML = explorer.innerHTML + result
	}
	function GenerateTableCustom(text,tabl,codefirst,code,codelast){
		tabl.sort();
		var result = `<font class="white-font" style="font-size:5em;">${text}</font><br>`+codefirst
		for(var src of tabl){
			result = result + code.replace(/{s}/g, src.replace(/</g, '&lt;').replace(/>/g, '&gt;'));
		}
		result = result + codelast + `<br>`
		explorer.innerHTML = explorer.innerHTML + result
	}
	
	var compiletimestart = new Date();
	GenerateTable("source/*.png",WoowzsiteSourceImagesPNG);
	GenerateTable("source/*.jpg",WoowzsiteSourceImagesJPG);
	GenerateTable("source/*.gif",WoowzsiteSourceImagesGIF);
	GenerateTable("source/*.ico",WoowzsiteSourceIcons);
	GenerateTable("source/*.cur",WoowzsiteSourceCursors);
	GenerateTable("source/specialforrandomsite/*",WoowzsiteSourceRandomSite);
	GenerateTable("core-wiki/source/*",WoowzsiteSourceCore);
	GenerateTable("source/woowzbackrooms/*",WoowzsiteSourceBackrooms);
	GenerateTable("source/woowzengine/*",WoowzsiteSourceWoowzengine);
	GenerateTable("source/discordavatars/*",WoowzsiteSourceDiscordAvatars);
	GenerateTable("source/cats/*.png",WoowzsiteSourceCats);
	GenerateTable("source/bloodeyesystems/*.png",WoowzsiteSourceBloodeyeSystems);
	GenerateTable("source/wldbackroomsgame/*.png",WoowzsiteSourceWldouiBackrooms);
	GenerateTable("source/bloodraw/*",WoowzsiteSourceBloodraw);
	GenerateTable("source/*.mp4",WoowzsiteSourceVideos);
	GenerateTableCustom("Слова",WoowzsiteWords,`<div style="background-color:rgba(0,0,0,0.2); font-size:2em; overflow-wrap: break-word; padding:5px; text-align: justify;">`,`<div style="display:inline-block; padding:5px;"><font class="src" onclick="CopyToClipboard('{s}');" style="cursor:pointer; background-color:rgb(250,250,250); border-radius: 20px; padding:5px;">{s}</font></div> `,`</div>`);
</script>